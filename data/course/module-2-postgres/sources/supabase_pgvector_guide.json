{
  "name": "Supabase pgvector Guide",
  "url": "https://supabase.com/docs/guides/ai/vector-columns",
  "pages": [
    {
      "url": "https://supabase.com/docs/guides/ai/vector-columns",
      "title": "Supabase pgvector Guide",
      "content_html": "<article class=\"prose max-w-none\" id=\"sb-docs-guide-main-article\"><h1 class=\"mb-0 [&amp;&gt;p]:m-0\"><p>Vector columns</p></h1><hr class=\"not-prose border-t-0 border-b my-8\"/><p>Supabase offers a number of different ways to store and query vectors within Postgres. The SQL included in this guide is applicable for clients in all programming languages. If you are a Python user see your <a href=\"https://supabase.com/docs/guides/ai/python-clients\" target=\"_blank\">Python client options</a> after reading the <code>Learn</code> section.</p>\n<p>Vectors in Supabase are enabled via <a href=\"https://github.com/pgvector/pgvector/\" target=\"_blank\">pgvector</a>, a Postgres extension for storing and querying vectors in Postgres. It can be used to store <a href=\"https://supabase.com/docs/guides/ai/concepts#what-are-embeddings\" target=\"_blank\">embeddings</a>.</p>\n<h2 class=\"group scroll-mt-24\" id=\"usage\">Usage<a aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\" href=\"https://supabase.com/docs/guides/ai/vector-columns#usage\" target=\"_blank\"><span aria-hidden=\"true\">#</span></a></h2>\n<h3 class=\"group scroll-mt-24\" id=\"enable-the-extension\">Enable the extension<a aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\" href=\"https://supabase.com/docs/guides/ai/vector-columns#enable-the-extension\" target=\"_blank\"><span aria-hidden=\"true\">#</span></a></h3>\n<div class=\"w-full justify-between space-y-4\" data-orientation=\"horizontal\" dir=\"ltr\"><div aria-orientation=\"horizontal\" class=\"flex items-center border-b border-secondary overflow-auto whitespace-nowrap no-scrollbar mask-fadeout-right flex-wrap\" data-orientation=\"horizontal\" role=\"tablist\" style=\"outline:none\" tabindex=\"-1\"><button aria-controls=\"radix-_R_14p5bsnlqbsnpcrlb_-content-dashboard\" aria-selected=\"true\" class=\"relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted text-sm leading-4 px-3 py-2 !text-foreground border-b-2 border-foreground\" data-orientation=\"horizontal\" data-radix-collection-item=\"\" data-state=\"active\" id=\"radix-_R_14p5bsnlqbsnpcrlb_-trigger-dashboard\" role=\"tab\" tabindex=\"-1\" type=\"button\"><span>Dashboard</span></button><button aria-controls=\"radix-_R_14p5bsnlqbsnpcrlb_-content-sql\" aria-selected=\"false\" class=\"relative cursor-pointer text-foreground-lighter flex items-center space-x-2 text-center transition focus:outline-none focus-visible:ring focus-visible:ring-foreground-muted focus-visible:border-foreground-muted text-sm leading-4 px-3 py-2 hover:text-foreground\" data-orientation=\"horizontal\" data-radix-collection-item=\"\" data-state=\"inactive\" id=\"radix-_R_14p5bsnlqbsnpcrlb_-trigger-sql\" role=\"tab\" tabindex=\"-1\" type=\"button\"><span>SQL</span></button></div><div aria-labelledby=\"radix-_R_14p5bsnlqbsnpcrlb_-trigger-dashboard\" class=\"focus:outline-none transition-height\" data-orientation=\"horizontal\" data-state=\"active\" id=\"radix-_R_14p5bsnlqbsnpcrlb_-content-dashboard\" role=\"tabpanel\" style=\"animation-duration:0s\" tabindex=\"0\"><ol>\n<li>Go to the <a href=\"https://supabase.com/dashboard/project/_/database/tables\" target=\"_blank\">Database</a> page in the Dashboard.</li>\n<li>Click on <strong>Extensions</strong> in the sidebar.</li>\n<li>Search for \"vector\" and enable the extension.</li>\n</ol></div><div aria-labelledby=\"radix-_R_14p5bsnlqbsnpcrlb_-trigger-sql\" class=\"focus:outline-none transition-height\" data-orientation=\"horizontal\" data-state=\"inactive\" hidden=\"\" id=\"radix-_R_14p5bsnlqbsnpcrlb_-content-sql\" role=\"tabpanel\" tabindex=\"0\"></div></div>\n<h3 class=\"group scroll-mt-24\" id=\"create-a-table-to-store-vectors\">Create a table to store vectors<a aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\" href=\"https://supabase.com/docs/guides/ai/vector-columns#create-a-table-to-store-vectors\" target=\"_blank\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>After enabling the <code>vector</code> extension, you will get access to a new data type called <code>vector</code>. The size of the vector (indicated in parenthesis) represents the number of dimensions stored in that vector.</p>\n<div class=\"shiki group relative not-prose w-full overflow-x-auto border border-default rounded-lg bg-200 text-sm\"><pre><code class=\"grid grid-cols-[auto_1fr]\"><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5 pt-6\">1</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6 pt-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">create</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">table</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-function)\">documents</span><span style=\"color:var(--code-foreground)\"> (</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">2</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  id </span><span style=\"color:var(--code-token-keyword)\">serial</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">primary key</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">3</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  title </span><span style=\"color:var(--code-token-keyword)\">text</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">not null</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">4</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  body </span><span style=\"color:var(--code-token-keyword)\">text</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">not null</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">5</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  embedding </span><span style=\"color:var(--code-token-constant)\">extensions</span><span style=\"color:var(--code-foreground)\">.</span><span style=\"color:var(--code-token-constant)\">vector</span><span style=\"color:var(--code-foreground)\">(</span><span style=\"color:var(--code-token-constant)\">384</span><span style=\"color:var(--code-foreground)\">)</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5 pb-6\">6</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6 pb-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">);</span></span></div></code></pre><div class=\"hidden group-hover:flex absolute top-2 right-2 gap-1\"><button aria-label=\"Enable word wrap\" class=\"border rounded-md p-1 hover:bg-selection transition\" data-state=\"closed\"><svg class=\"lucide lucide-wrap-text text-lighter\" fill=\"none\" height=\"14\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"14\" xmlns=\"http://www.w3.org/2000/svg\"><line x1=\"3\" x2=\"21\" y1=\"6\" y2=\"6\"></line><path d=\"M3 12h15a3 3 0 1 1 0 6h-4\"></path><polyline points=\"16 16 14 18 16 20\"></polyline><line x1=\"3\" x2=\"10\" y1=\"18\" y2=\"18\"></line></svg></button><button class=\"border rounded-md p-1 hover:bg-selection transition\"><svg class=\"lucide lucide-copy text-lighter\" fill=\"none\" height=\"14\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"14\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div>\n<p>In the above SQL snippet, we create a <code>documents</code> table with a column called <code>embedding</code> (note this is just a regular Postgres column - you can name it whatever you like). We give the <code>embedding</code> column a <code>vector</code> data type with 384 dimensions. Change this to the number of dimensions produced by your embedding model. For example, if you are <a href=\"https://supabase.com/docs/guides/ai/quickstarts/generate-text-embeddings\" target=\"_blank\">generating embeddings</a> using the open source <a href=\"https://huggingface.co/Supabase/gte-small\" target=\"_blank\"><code>gte-small</code></a> model, you would set this number to 384 since that model produces 384 dimensions.</p>\n<div class=\"relative w-full text-sm rounded-lg border p-4 [&amp;&gt;svg~*]:pl-10 [&amp;&gt;svg]:absolute [&amp;&gt;svg]:left-4 [&amp;&gt;svg]:top-4 [&amp;&gt;svg]:w-[23px] [&amp;&gt;svg]:h-[23px] [&amp;&gt;svg]:p-1 [&amp;&gt;svg]:flex [&amp;&gt;svg]:rounded bg-surface-200/25 border-default text-foreground [&amp;&gt;svg]:text-background overflow-hidden [&amp;&gt;svg]:bg-foreground-muted mb-8\" role=\"alert\"><svg class=\"w-6 h-6\" fill=\"currentColor\" viewbox=\"0 0 21 20\" xmlns=\"http://www.w3.org/2000/svg\"><path clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\" fill-rule=\"evenodd\"></path></svg><div class=\"flex flex-col\"><div class=\"text my-0.5 [&amp;_p]:mt-0 [&amp;_p]:mb-1.5 [&amp;_p:last-child]:mb-0\"><p>In general, embeddings with fewer dimensions perform best. See our <a href=\"https://supabase.com/blog/fewer-dimensions-are-better-pgvector\" target=\"_blank\">analysis on fewer dimensions in pgvector</a>.</p></div></div></div>\n<h3 class=\"group scroll-mt-24\" id=\"storing-a-vector--embedding\">Storing a vector / embedding<a aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\" href=\"https://supabase.com/docs/guides/ai/vector-columns#storing-a-vector--embedding\" target=\"_blank\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>In this example we'll generate a vector using Transformers.js, then store it in the database using the Supabase JavaScript client.</p>\n<div class=\"shiki group relative not-prose w-full overflow-x-auto border border-default rounded-lg bg-200 text-sm\"><pre><code class=\"grid grid-cols-[auto_1fr]\"><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5 pt-6\">1</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6 pt-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">import</span><span style=\"color:var(--code-token-string-expression)\"> </span><span style=\"color:var(--code-token-punctuation)\">{</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-parameter)\">pipeline</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-punctuation)\">}</span><span style=\"color:var(--code-token-string-expression)\"> </span><span style=\"color:var(--code-token-keyword)\">from</span><span style=\"color:var(--code-token-string-expression)\"> </span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-string-expression)\">@xenova/transformers</span><span style=\"color:var(--code-token-punctuation)\">'</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">2</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">const</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">generateEmbedding</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">=</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">await</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-function)\">pipeline</span><span style=\"color:var(--code-foreground)\">(</span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-string-expression)\">feature-extraction</span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-punctuation)\">,</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-string-expression)\">Supabase/gte-small</span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-foreground)\">)</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">3</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">4</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">const</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">title</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">=</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-string-expression)\">First post!</span><span style=\"color:var(--code-token-punctuation)\">'</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">5</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">const</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">body</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">=</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-string-expression)\">Hello world!</span><span style=\"color:var(--code-token-punctuation)\">'</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">6</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">7</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-comment);font-style:italic\">// Generate a vector using Transformers.js</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">8</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">const</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">output</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">=</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">await</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-function)\">generateEmbedding</span><span style=\"color:var(--code-foreground)\">(</span><span style=\"color:var(--code-token-parameter)\">body</span><span style=\"color:var(--code-token-punctuation)\">,</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">{</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">9</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-variable)\">  </span><span style=\"color:var(--code-token-property)\">pooling</span><span style=\"color:var(--code-token-punctuation)\">:</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-string-expression)\">mean</span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-punctuation)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">10</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-variable)\">  </span><span style=\"color:var(--code-token-property)\">normalize</span><span style=\"color:var(--code-token-punctuation)\">:</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">true</span><span style=\"color:var(--code-token-punctuation)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">11</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-punctuation)\">}</span><span style=\"color:var(--code-foreground)\">)</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">12</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">13</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-comment);font-style:italic\">// Extract the embedding output</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">14</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">const</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">embedding</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">=</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-parameter)\">Array</span><span style=\"color:var(--code-token-punctuation)\">.</span><span style=\"color:var(--code-token-function)\">from</span><span style=\"color:var(--code-foreground)\">(</span><span style=\"color:var(--code-token-parameter)\">output</span><span style=\"color:var(--code-token-punctuation)\">.</span><span style=\"color:var(--code-token-parameter)\">data</span><span style=\"color:var(--code-foreground)\">)</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">15</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">16</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-comment);font-style:italic\">// Store the vector in Postgres</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">17</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">const</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">{</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">data</span><span style=\"color:var(--code-token-punctuation)\">,</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">error</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">}</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">=</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">await</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-parameter)\">supabase</span><span style=\"color:var(--code-token-punctuation)\">.</span><span style=\"color:var(--code-token-function)\">from</span><span style=\"color:var(--code-foreground)\">(</span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-string-expression)\">documents</span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-foreground)\">)</span><span style=\"color:var(--code-token-punctuation)\">.</span><span style=\"color:var(--code-token-function)\">insert</span><span style=\"color:var(--code-foreground)\">(</span><span style=\"color:var(--code-token-punctuation)\">{</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">18</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-variable)\">  </span><span style=\"color:var(--code-token-parameter)\">title</span><span style=\"color:var(--code-token-punctuation)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">19</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-variable)\">  </span><span style=\"color:var(--code-token-parameter)\">body</span><span style=\"color:var(--code-token-punctuation)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">20</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-variable)\">  </span><span style=\"color:var(--code-token-parameter)\">embedding</span><span style=\"color:var(--code-token-punctuation)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5 pb-6\">21</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6 pb-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-punctuation)\">}</span><span style=\"color:var(--code-foreground)\">)</span></span></div></code></pre><div class=\"hidden group-hover:flex absolute top-2 right-2 gap-1\"><button aria-label=\"Enable word wrap\" class=\"border rounded-md p-1 hover:bg-selection transition\" data-state=\"closed\"><svg class=\"lucide lucide-wrap-text text-lighter\" fill=\"none\" height=\"14\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"14\" xmlns=\"http://www.w3.org/2000/svg\"><line x1=\"3\" x2=\"21\" y1=\"6\" y2=\"6\"></line><path d=\"M3 12h15a3 3 0 1 1 0 6h-4\"></path><polyline points=\"16 16 14 18 16 20\"></polyline><line x1=\"3\" x2=\"10\" y1=\"18\" y2=\"18\"></line></svg></button><button class=\"border rounded-md p-1 hover:bg-selection transition\"><svg class=\"lucide lucide-copy text-lighter\" fill=\"none\" height=\"14\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"14\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div>\n<p>This example uses the JavaScript Supabase client, but you can modify it to work with any <a href=\"https://supabase.com/docs#client-libraries\" target=\"_blank\">supported language library</a>.</p>\n<h3 class=\"group scroll-mt-24\" id=\"querying-a-vector--embedding\">Querying a vector / embedding<a aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\" href=\"https://supabase.com/docs/guides/ai/vector-columns#querying-a-vector--embedding\" target=\"_blank\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Similarity search is the most common use case for vectors. <code>pgvector</code> support 3 new operators for computing distance:</p>\n<table><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody><tr><td><code>&lt;-&gt;</code></td><td>Euclidean distance</td></tr><tr><td><code>&lt;#&gt;</code></td><td>negative inner product</td></tr><tr><td><code>&lt;=&gt;</code></td><td>cosine distance</td></tr></tbody></table>\n<p>Choosing the right operator depends on your needs. Dot product tends to be the fastest if your vectors are normalized. For more information on how embeddings work and how they relate to each other, see <a href=\"https://supabase.com/docs/guides/ai/concepts#what-are-embeddings\" target=\"_blank\">What are Embeddings?</a>.</p>\n<p>Supabase client libraries like <code>supabase-js</code> connect to your Postgres instance via <a href=\"https://supabase.com/docs/guides/getting-started/architecture#postgrest-api\" target=\"_blank\">PostgREST</a>. PostgREST does not currently support <code>pgvector</code> similarity operators, so we'll need to wrap our query in a Postgres function and call it via the <code>rpc()</code> method:</p>\n<div class=\"shiki group relative not-prose w-full overflow-x-auto border border-default rounded-lg bg-200 text-sm\"><pre><code class=\"grid grid-cols-[auto_1fr]\"><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5 pt-6\">1</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6 pt-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">create or replace</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">function</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-function)\">match_documents</span><span style=\"color:var(--code-foreground)\"> (</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">2</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  query_embedding </span><span style=\"color:var(--code-token-constant)\">extensions</span><span style=\"color:var(--code-foreground)\">.</span><span style=\"color:var(--code-token-constant)\">vector</span><span style=\"color:var(--code-foreground)\">(</span><span style=\"color:var(--code-token-constant)\">384</span><span style=\"color:var(--code-foreground)\">),</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">3</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  match_threshold </span><span style=\"color:var(--code-token-keyword)\">float</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">4</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  match_count </span><span style=\"color:var(--code-token-keyword)\">int</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">5</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">)</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">6</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">returns</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">table</span><span style=\"color:var(--code-foreground)\"> (</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">7</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  id </span><span style=\"color:var(--code-token-keyword)\">bigint</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">8</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  title </span><span style=\"color:var(--code-token-keyword)\">text</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">9</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  body </span><span style=\"color:var(--code-token-keyword)\">text</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">10</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  similarity </span><span style=\"color:var(--code-token-keyword)\">float</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">11</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">)</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">12</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">language</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">sql</span><span style=\"color:var(--code-foreground)\"> stable</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">13</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">as</span><span style=\"color:var(--code-foreground)\"> $$</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">14</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  </span><span style=\"color:var(--code-token-keyword)\">select</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">15</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">    </span><span style=\"color:var(--code-token-constant)\">documents</span><span style=\"color:var(--code-foreground)\">.</span><span style=\"color:var(--code-token-constant)\">id</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">16</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">    </span><span style=\"color:var(--code-token-constant)\">documents</span><span style=\"color:var(--code-foreground)\">.</span><span style=\"color:var(--code-token-constant)\">title</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">17</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">    </span><span style=\"color:var(--code-token-constant)\">documents</span><span style=\"color:var(--code-foreground)\">.</span><span style=\"color:var(--code-token-constant)\">body</span><span style=\"color:var(--code-foreground)\">,</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">18</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">    </span><span style=\"color:var(--code-token-constant)\">1</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">-</span><span style=\"color:var(--code-foreground)\"> (</span><span style=\"color:var(--code-token-constant)\">documents</span><span style=\"color:var(--code-foreground)\">.</span><span style=\"color:var(--code-token-constant)\">embedding</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">&lt;=&gt;</span><span style=\"color:var(--code-foreground)\"> query_embedding) </span><span style=\"color:var(--code-token-keyword)\">as</span><span style=\"color:var(--code-foreground)\"> similarity</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">19</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  </span><span style=\"color:var(--code-token-keyword)\">from</span><span style=\"color:var(--code-foreground)\"> documents</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">20</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  </span><span style=\"color:var(--code-token-keyword)\">where</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-constant)\">1</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">-</span><span style=\"color:var(--code-foreground)\"> (</span><span style=\"color:var(--code-token-constant)\">documents</span><span style=\"color:var(--code-foreground)\">.</span><span style=\"color:var(--code-token-constant)\">embedding</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">&lt;=&gt;</span><span style=\"color:var(--code-foreground)\"> query_embedding) </span><span style=\"color:var(--code-token-keyword)\">&gt;</span><span style=\"color:var(--code-foreground)\"> match_threshold</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">21</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  </span><span style=\"color:var(--code-token-keyword)\">order by</span><span style=\"color:var(--code-foreground)\"> (</span><span style=\"color:var(--code-token-constant)\">documents</span><span style=\"color:var(--code-foreground)\">.</span><span style=\"color:var(--code-token-constant)\">embedding</span><span style=\"color:var(--code-foreground)\"> </span><span style=\"color:var(--code-token-keyword)\">&lt;=&gt;</span><span style=\"color:var(--code-foreground)\"> query_embedding) </span><span style=\"color:var(--code-token-keyword)\">asc</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">22</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">  </span><span style=\"color:var(--code-token-keyword)\">limit</span><span style=\"color:var(--code-foreground)\"> match_count;</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5 pb-6\">23</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6 pb-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-foreground)\">$$;</span></span></div></code></pre><div class=\"hidden group-hover:flex absolute top-2 right-2 gap-1\"><button aria-label=\"Enable word wrap\" class=\"border rounded-md p-1 hover:bg-selection transition\" data-state=\"closed\"><svg class=\"lucide lucide-wrap-text text-lighter\" fill=\"none\" height=\"14\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"14\" xmlns=\"http://www.w3.org/2000/svg\"><line x1=\"3\" x2=\"21\" y1=\"6\" y2=\"6\"></line><path d=\"M3 12h15a3 3 0 1 1 0 6h-4\"></path><polyline points=\"16 16 14 18 16 20\"></polyline><line x1=\"3\" x2=\"10\" y1=\"18\" y2=\"18\"></line></svg></button><button class=\"border rounded-md p-1 hover:bg-selection transition\"><svg class=\"lucide lucide-copy text-lighter\" fill=\"none\" height=\"14\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"14\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div>\n<p>This function takes a <code>query_embedding</code> argument and compares it to all other embeddings in the <code>documents</code> table. Each comparison returns a similarity score. If the similarity is greater than the <code>match_threshold</code> argument, it is returned. The number of rows returned is limited by the <code>match_count</code> argument.</p>\n<p>Feel free to modify this method to fit the needs of your application. The <code>match_threshold</code> ensures that only documents that have a minimum similarity to the <code>query_embedding</code> are returned. Without this, you may end up returning documents that subjectively don't match. This value will vary for each application - you will need to perform your own testing to determine the threshold that makes sense for your app.</p>\n<p>If you index your vector column, ensure that the <code>order by</code> sorts by the distance function directly (rather than sorting by the calculated <code>similarity</code> column, which may lead to the index being ignored and poor performance).</p>\n<p>To execute the function from your client library, call <code>rpc()</code> with the name of your Postgres function:</p>\n<div class=\"shiki group relative not-prose w-full overflow-x-auto border border-default rounded-lg bg-200 text-sm\"><pre><code class=\"grid grid-cols-[auto_1fr]\"><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5 pt-6\">1</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6 pt-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-keyword)\">const</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">{</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-parameter)\">data</span><span style=\"color:var(--code-token-punctuation)\">:</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">documents</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">}</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">=</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-keyword)\">await</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-parameter)\">supabaseClient</span><span style=\"color:var(--code-token-punctuation)\">.</span><span style=\"color:var(--code-token-function)\">rpc</span><span style=\"color:var(--code-foreground)\">(</span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-string-expression)\">match_documents</span><span style=\"color:var(--code-token-punctuation)\">'</span><span style=\"color:var(--code-token-punctuation)\">,</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-punctuation)\">{</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">2</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-variable)\">  </span><span style=\"color:var(--code-token-property)\">query_embedding</span><span style=\"color:var(--code-token-punctuation)\">:</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-parameter)\">embedding</span><span style=\"color:var(--code-token-punctuation)\">,</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-comment);font-style:italic\">// Pass the embedding you want to compare</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">3</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-variable)\">  </span><span style=\"color:var(--code-token-property)\">match_threshold</span><span style=\"color:var(--code-token-punctuation)\">:</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">0.78</span><span style=\"color:var(--code-token-punctuation)\">,</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-comment);font-style:italic\">// Choose an appropriate threshold for your data</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5\">4</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-variable)\">  </span><span style=\"color:var(--code-token-property)\">match_count</span><span style=\"color:var(--code-token-punctuation)\">:</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-constant)\">10</span><span style=\"color:var(--code-token-punctuation)\">,</span><span style=\"color:var(--code-token-variable)\"> </span><span style=\"color:var(--code-token-comment);font-style:italic\">// Choose the number of matches</span></span></div><div class=\"select-none text-right text-muted bg-control px-2 min-h-5 leading-5 pb-6\">5</div><div class=\"code-content min-h-5 leading-5 pl-6 pr-6 pb-6\"><span class=\"block min-h-5 leading-5\"><span style=\"color:var(--code-token-punctuation)\">}</span><span style=\"color:var(--code-foreground)\">)</span></span></div></code></pre><div class=\"hidden group-hover:flex absolute top-2 right-2 gap-1\"><button aria-label=\"Enable word wrap\" class=\"border rounded-md p-1 hover:bg-selection transition\" data-state=\"closed\"><svg class=\"lucide lucide-wrap-text text-lighter\" fill=\"none\" height=\"14\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"14\" xmlns=\"http://www.w3.org/2000/svg\"><line x1=\"3\" x2=\"21\" y1=\"6\" y2=\"6\"></line><path d=\"M3 12h15a3 3 0 1 1 0 6h-4\"></path><polyline points=\"16 16 14 18 16 20\"></polyline><line x1=\"3\" x2=\"10\" y1=\"18\" y2=\"18\"></line></svg></button><button class=\"border rounded-md p-1 hover:bg-selection transition\"><svg class=\"lucide lucide-copy text-lighter\" fill=\"none\" height=\"14\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"14\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div>\n<p>In this example <code>embedding</code> would be another embedding you wish to compare against your table of pre-generated embedding documents. For example if you were building a search engine, every time the user submits their query you would first generate an embedding on the search query itself, then pass it into the above <code>rpc()</code> function to match.</p>\n<div class=\"relative w-full text-sm rounded-lg border p-4 [&amp;&gt;svg~*]:pl-10 [&amp;&gt;svg]:absolute [&amp;&gt;svg]:left-4 [&amp;&gt;svg]:top-4 [&amp;&gt;svg]:w-[23px] [&amp;&gt;svg]:h-[23px] [&amp;&gt;svg]:p-1 [&amp;&gt;svg]:flex [&amp;&gt;svg]:rounded bg-surface-200/25 border-default text-foreground [&amp;&gt;svg]:text-background overflow-hidden [&amp;&gt;svg]:bg-foreground-muted mb-8\" role=\"alert\"><svg class=\"w-6 h-6\" fill=\"currentColor\" viewbox=\"0 0 21 20\" xmlns=\"http://www.w3.org/2000/svg\"><path clip-rule=\"evenodd\" d=\"M0.625 9.8252C0.625 4.44043 4.99023 0.0751953 10.375 0.0751953C15.7598 0.0751953 20.125 4.44043 20.125 9.8252C20.125 15.21 15.7598 19.5752 10.375 19.5752C4.99023 19.5752 0.625 15.21 0.625 9.8252ZM9.3584 4.38135C9.45117 4.28857 9.55518 4.20996 9.66699 4.14648C9.88086 4.02539 10.1245 3.96045 10.375 3.96045C10.5845 3.96045 10.7896 4.00586 10.9766 4.09229C11.1294 4.1626 11.2705 4.26025 11.3916 4.38135C11.6611 4.65088 11.8125 5.0166 11.8125 5.39795C11.8125 5.5249 11.7959 5.6499 11.7637 5.77002C11.6987 6.01172 11.5718 6.23438 11.3916 6.41455C11.1221 6.68408 10.7563 6.83545 10.375 6.83545C9.99365 6.83545 9.62793 6.68408 9.3584 6.41455C9.08887 6.14502 8.9375 5.7793 8.9375 5.39795C8.9375 5.29492 8.94873 5.19287 8.97021 5.09375C9.02783 4.82568 9.16162 4.57812 9.3584 4.38135ZM10.375 15.6899C10.0933 15.6899 9.82275 15.5781 9.62354 15.3789C9.42432 15.1797 9.3125 14.9092 9.3125 14.6274V9.31494C9.3125 9.0332 9.42432 8.7627 9.62354 8.56348C9.82275 8.36426 10.0933 8.25244 10.375 8.25244C10.6567 8.25244 10.9272 8.36426 11.1265 8.56348C11.3257 8.7627 11.4375 9.0332 11.4375 9.31494V14.6274C11.4375 14.7944 11.3979 14.9575 11.3242 15.104C11.2739 15.2046 11.2075 15.2979 11.1265 15.3789C10.9272 15.5781 10.6567 15.6899 10.375 15.6899Z\" fill-rule=\"evenodd\"></path></svg><div class=\"flex flex-col\"><div class=\"text my-0.5 [&amp;_p]:mt-0 [&amp;_p]:mb-1.5 [&amp;_p:last-child]:mb-0\"><p>Be sure to use embeddings produced from the same embedding model when calculating distance. Comparing embeddings from two different models will produce no meaningful result.</p></div></div></div>\n<p>Vectors and embeddings can be used for much more than search. Learn more about embeddings at <a href=\"https://supabase.com/docs/guides/ai/concepts#what-are-embeddings\" target=\"_blank\">What are Embeddings?</a>.</p>\n<h3 class=\"group scroll-mt-24\" id=\"indexes\">Indexes<a aria-hidden=\"true\" class=\"ml-2 opacity-0 group-hover:opacity-100 transition\" href=\"https://supabase.com/docs/guides/ai/vector-columns#indexes\" target=\"_blank\"><span aria-hidden=\"true\">#</span></a></h3>\n<p>Once your vector table starts to grow, you will likely want to add an index to speed up queries. See <a href=\"https://supabase.com/docs/guides/ai/vector-indexes\" target=\"_blank\">Vector indexes</a> to learn how vector indexes work and how to create them.</p></article>",
      "text": "Vector columns\nSupabase offers a number of different ways to store and query vectors within Postgres. The SQL included in this guide is applicable for clients in all programming languages. If you are a Python user see your\nPython client options\nafter reading the\nLearn\nsection.\nVectors in Supabase are enabled via\npgvector\n, a Postgres extension for storing and querying vectors in Postgres. It can be used to store\nembeddings\n.\nUsage\n#\nEnable the extension\n#\nDashboard\nSQL\nGo to the\nDatabase\npage in the Dashboard.\nClick on\nExtensions\nin the sidebar.\nSearch for \"vector\" and enable the extension.\nCreate a table to store vectors\n#\nAfter enabling the\nvector\nextension, you will get access to a new data type called\nvector\n. The size of the vector (indicated in parenthesis) represents the number of dimensions stored in that vector.\n1\ncreate\ntable\ndocuments\n(\n2\nid\nserial\nprimary key\n,\n3\ntitle\ntext\nnot null\n,\n4\nbody\ntext\nnot null\n,\n5\nembedding\nextensions\n.\nvector\n(\n384\n)\n6\n);\nIn the above SQL snippet, we create a\ndocuments\ntable with a column called\nembedding\n(note this is just a regular Postgres column - you can name it whatever you like). We give the\nembedding\ncolumn a\nvector\ndata type with 384 dimensions. Change this to the number of dimensions produced by your embedding model. For example, if you are\ngenerating embeddings\nusing the open source\ngte-small\nmodel, you would set this number to 384 since that model produces 384 dimensions.\nIn general, embeddings with fewer dimensions perform best. See our\nanalysis on fewer dimensions in pgvector\n.\nStoring a vector / embedding\n#\nIn this example we'll generate a vector using Transformers.js, then store it in the database using the Supabase JavaScript client.\n1\nimport\n{\npipeline\n}\nfrom\n'\n@xenova/transformers\n'\n2\nconst\ngenerateEmbedding\n=\nawait\npipeline\n(\n'\nfeature-extraction\n'\n,\n'\nSupabase/gte-small\n'\n)\n3\n4\nconst\ntitle\n=\n'\nFirst post!\n'\n5\nconst\nbody\n=\n'\nHello world!\n'\n6\n7\n// Generate a vector using Transformers.js\n8\nconst\noutput\n=\nawait\ngenerateEmbedding\n(\nbody\n,\n{\n9\npooling\n:\n'\nmean\n'\n,\n10\nnormalize\n:\ntrue\n,\n11\n}\n)\n12\n13\n// Extract the embedding output\n14\nconst\nembedding\n=\nArray\n.\nfrom\n(\noutput\n.\ndata\n)\n15\n16\n// Store the vector in Postgres\n17\nconst\n{\ndata\n,\nerror\n}\n=\nawait\nsupabase\n.\nfrom\n(\n'\ndocuments\n'\n)\n.\ninsert\n(\n{\n18\ntitle\n,\n19\nbody\n,\n20\nembedding\n,\n21\n}\n)\nThis example uses the JavaScript Supabase client, but you can modify it to work with any\nsupported language library\n.\nQuerying a vector / embedding\n#\nSimilarity search is the most common use case for vectors.\npgvector\nsupport 3 new operators for computing distance:\nOperator\nDescription\n<->\nEuclidean distance\n<#>\nnegative inner product\n<=>\ncosine distance\nChoosing the right operator depends on your needs. Dot product tends to be the fastest if your vectors are normalized. For more information on how embeddings work and how they relate to each other, see\nWhat are Embeddings?\n.\nSupabase client libraries like\nsupabase-js\nconnect to your Postgres instance via\nPostgREST\n. PostgREST does not currently support\npgvector\nsimilarity operators, so we'll need to wrap our query in a Postgres function and call it via the\nrpc()\nmethod:\n1\ncreate or replace\nfunction\nmatch_documents\n(\n2\nquery_embedding\nextensions\n.\nvector\n(\n384\n),\n3\nmatch_threshold\nfloat\n,\n4\nmatch_count\nint\n5\n)\n6\nreturns\ntable\n(\n7\nid\nbigint\n,\n8\ntitle\ntext\n,\n9\nbody\ntext\n,\n10\nsimilarity\nfloat\n11\n)\n12\nlanguage\nsql\nstable\n13\nas\n$$\n14\nselect\n15\ndocuments\n.\nid\n,\n16\ndocuments\n.\ntitle\n,\n17\ndocuments\n.\nbody\n,\n18\n1\n-\n(\ndocuments\n.\nembedding\n<=>\nquery_embedding)\nas\nsimilarity\n19\nfrom\ndocuments\n20\nwhere\n1\n-\n(\ndocuments\n.\nembedding\n<=>\nquery_embedding)\n>\nmatch_threshold\n21\norder by\n(\ndocuments\n.\nembedding\n<=>\nquery_embedding)\nasc\n22\nlimit\nmatch_count;\n23\n$$;\nThis function takes a\nquery_embedding\nargument and compares it to all other embeddings in the\ndocuments\ntable. Each comparison returns a similarity score. If the similarity is greater than the\nmatch_threshold\nargument, it is returned. The number of rows returned is limited by the\nmatch_count\nargument.\nFeel free to modify this method to fit the needs of your application. The\nmatch_threshold\nensures that only documents that have a minimum similarity to the\nquery_embedding\nare returned. Without this, you may end up returning documents that subjectively don't match. This value will vary for each application - you will need to perform your own testing to determine the threshold that makes sense for your app.\nIf you index your vector column, ensure that the\norder by\nsorts by the distance function directly (rather than sorting by the calculated\nsimilarity\ncolumn, which may lead to the index being ignored and poor performance).\nTo execute the function from your client library, call\nrpc()\nwith the name of your Postgres function:\n1\nconst\n{\ndata\n:\ndocuments\n}\n=\nawait\nsupabaseClient\n.\nrpc\n(\n'\nmatch_documents\n'\n,\n{\n2\nquery_embedding\n:\nembedding\n,\n// Pass the embedding you want to compare\n3\nmatch_threshold\n:\n0.78\n,\n// Choose an appropriate threshold for your data\n4\nmatch_count\n:\n10\n,\n// Choose the number of matches\n5\n}\n)\nIn this example\nembedding\nwould be another embedding you wish to compare against your table of pre-generated embedding documents. For example if you were building a search engine, every time the user submits their query you would first generate an embedding on the search query itself, then pass it into the above\nrpc()\nfunction to match.\nBe sure to use embeddings produced from the same embedding model when calculating distance. Comparing embeddings from two different models will produce no meaningful result.\nVectors and embeddings can be used for much more than search. Learn more about embeddings at\nWhat are Embeddings?\n.\nIndexes\n#\nOnce your vector table starts to grow, you will likely want to add an index to speed up queries. See\nVector indexes\nto learn how vector indexes work and how to create them.",
      "code_blocks": [
        {
          "lang": "",
          "code": "1create table documents (2  id serial primary key,3  title text not null,4  body text not null,5  embedding extensions.vector(384)6);"
        },
        {
          "lang": "",
          "code": "1import { pipeline } from '@xenova/transformers'2const generateEmbedding = await pipeline('feature-extraction', 'Supabase/gte-small')34const title = 'First post!'5const body = 'Hello world!'67// Generate a vector using Transformers.js8const output = await generateEmbedding(body, {9  pooling: 'mean',10  normalize: true,11})1213// Extract the embedding output14const embedding = Array.from(output.data)1516// Store the vector in Postgres17const { data, error } = await supabase.from('documents').insert({18  title,19  body,20  embedding,21})"
        },
        {
          "lang": "",
          "code": "1create or replace function match_documents (2  query_embedding extensions.vector(384),3  match_threshold float,4  match_count int5)6returns table (7  id bigint,8  title text,9  body text,10  similarity float11)12language sql stable13as $$14  select15    documents.id,16    documents.title,17    documents.body,18    1 - (documents.embedding <=> query_embedding) as similarity19  from documents20  where 1 - (documents.embedding <=> query_embedding) > match_threshold21  order by (documents.embedding <=> query_embedding) asc22  limit match_count;23$$;"
        },
        {
          "lang": "",
          "code": "1const { data: documents } = await supabaseClient.rpc('match_documents', {2  query_embedding: embedding, // Pass the embedding you want to compare3  match_threshold: 0.78, // Choose an appropriate threshold for your data4  match_count: 10, // Choose the number of matches5})"
        }
      ],
      "headings": [
        {
          "level": 1,
          "text": "Vector columns"
        },
        {
          "level": 2,
          "text": "Usage#"
        },
        {
          "level": 3,
          "text": "Enable the extension#"
        },
        {
          "level": 3,
          "text": "Create a table to store vectors#"
        },
        {
          "level": 3,
          "text": "Storing a vector / embedding#"
        },
        {
          "level": 3,
          "text": "Querying a vector / embedding#"
        },
        {
          "level": 3,
          "text": "Indexes#"
        }
      ]
    }
  ]
}